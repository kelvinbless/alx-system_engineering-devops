#!/usr/bin/env bash
# 0-change_your_home_IP
# Configure /etc/hosts so:
# - localhost -> 127.0.0.2
# - facebook.com -> 8.8.8.8

set -euo pipefail

HOSTS_FILE="/etc/hosts"

# Must be run as root (checker uses sudo ./script)
if [[ "${EUID}" -ne 0 ]]; then
  echo "This script must be run as root (use sudo)." >&2
  exit 1
fi

# Backup once per run (simple and safe)
cp -f "$HOSTS_FILE" "${HOSTS_FILE}.bak"

# ---- Ensure localhost -> 127.0.0.2 ----
# Remove any existing lines that define localhost (so we can replace cleanly)
# Keep IPv6 localhost entries intact.
sed -i '/^[[:space:]]*127\.[0-9.]\+[[:space:]]\+.*\blocalhost\b/d' "$HOSTS_FILE"

# Add our required mapping (and common aliases, harmless)
echo "127.0.0.2 localhost" >> "$HOSTS_FILE"

# ---- Ensure facebook.com -> 8.8.8.8 ----
# Remove any existing facebook.com mapping (any IP)
sed -i '/^[[:space:]]*[0-9.]\+[[:space:]]\+.*\bfacebook\.com\b/d' "$HOSTS_FILE"

# Add required mapping
echo "8.8.8.8 facebook.com" >> "$HOSTS_FILE"

exit 0
